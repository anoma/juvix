working-directory: ./../../../tests/
tests:
  - name: flag-help-shows-juvix-file-for-autocompletion
    command:
      - juvix
      - typecheck
      - --help
    stdout:
      contains: 'Usage: juvix typecheck JUVIX_FILE'
    exit-status: 0

  - name: check-simple-file
    command:
      - juvix
      - typecheck
    args:
      - positive/Internal/Simple.juvix
    stdout:
      equals: "Well done! It type checks\n"
    exit-status: 0

  - name: flag-only-errors
    command:
      - juvix
      - --only-errors
      - typecheck
    args:
      - positive/Internal/Simple.juvix
    stdout: ''
    exit-status: 0

  - name: get-typechecking-error
    command:
      - juvix
      - --no-colors
      - typecheck
    args:
      - negative/Internal/MultiWrongType.juvix
    stdout: ''
    stderr:
      matches: |-
        (.+)\/([^\/]+)\.juvix\:[0-9]*\:[0-9]*\-[0-9]*\: error
    exit-status: 1

  - name: typecheck-fancy-paths
    command:
      shell:
        - bash
      script: |
        temp=$(mktemp -d)
        trap 'rm -rf -- "$temp"' EXIT
        export XDG_CONFIG_HOME="$temp"
        HOME="home" JUVIX_TEST_PATH="other dep" juvix typecheck positive/FancyPaths/Main.juvix
    stdout:
      equals: "Well done! It type checks\n"
    exit-status: 0

  - name: typecheck-stdin
    command:
      - juvix
      - --stdin
      - typecheck
    args:
      - positive/Internal/Simple.juvix
    stdin: 'module OtherModule; import Stdlib.Prelude open; main : Nat := 5;'
    stderr:
      contains: 'positive/Internal/Simple.juvix'
    exit-status: 1
